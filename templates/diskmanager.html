{% extends "base.html" %}

{% block title %}磁盘管理{% endblock %}

{% block content %}
  <h2>磁盘容量管理</h2>

  <!-- 总体容量显示 -->
  <p>总容量: {{ total }} GB</p>
  <p>已用: {{ used }} GB</p>
  <p>剩余: {{ free }} GB</p>
  <p>使用率: {{ percent_used }}%</p>

  <div class="progress mb-4" style="height: 25px; max-width: 500px;">
    <div class="progress-bar" role="progressbar" style="width: {{ percent_used }}%;" aria-valuenow="{{ percent_used }}" aria-valuemin="0" aria-valuemax="100">
      {{ percent_used }}%
    </div>
  </div>

  <!-- 清理按钮 -->
  <form method="post" action="{{ url_for('diskmanager.clean_tmp') }}" onsubmit="return confirm('确定要清理 /tmp 目录吗？此操作不可恢复！')">
    <button type="submit" class="btn btn-danger">🧹 清理 /tmp 目录</button>
  </form>

  <!-- 闪现提示 -->
  {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
      <div class="mt-3">
        {% for category, message in messages %}
          <div class="alert alert-{{ category }}">{{ message }}</div>
        {% endfor %}
      </div>
    {% endif %}
  {% endwith %}

  <!-- 分隔线 -->
  <hr class="my-4">

  <!-- 根目录各文件夹磁盘使用情况 -->
  <h4>📂 根目录各文件夹占用情况</h4>
  <ul class="list-group">
    {% for folder in folder_usage %}
      <li class="list-group-item d-flex justify-content-between align-items-center">
        <span>/{{ folder.name }}</span>
        <div style="flex: 1; margin: 0 10px;">
          <div class="progress">
            <div class="progress-bar bg-info" role="progressbar" style="width: {{ folder.percent|round(2) }}%;" aria-valuenow="{{ folder.percent }}" aria-valuemin="0" aria-valuemax="100"></div>
          </div>
        </div>
        <span>{{ (folder.size / (1024**2)) | round(1) }} MB</span>
      </li>
    {% endfor %}
  </ul>
{% endblock %}
